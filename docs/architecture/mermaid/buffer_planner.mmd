stateDiagram-v2
  direction TB
  [*] --> idle
  idle --> resetting : plan [valid_plan_] / begin_plan_
  idle --> errored : plan [always] / reject_plan_
  resetting --> seeding_leafs : [always] / run_reset_
  seeding_leafs --> errored : [lambda_guards_11_38] / none
  seeding_leafs --> counting_references : [lambda_guards_7_34] / run_seed_leafs_
  counting_references --> errored : [lambda_guards_11_38] / none
  counting_references --> allocating_explicit_inputs : [lambda_guards_7_34] / run_count_references_
  allocating_explicit_inputs --> errored : [lambda_guards_11_38] / none
  allocating_explicit_inputs --> planning_nodes : [lambda_guards_7_34] / run_alloc_explicit_inputs_
  planning_nodes --> errored : [lambda_guards_11_38] / none
  planning_nodes --> releasing_expired : [lambda_guards_7_34] / run_plan_nodes_
  releasing_expired --> errored : [lambda_guards_11_38] / none
  releasing_expired --> finalizing : [lambda_guards_7_34] / run_release_expired_
  finalizing --> errored : [lambda_guards_11_38] / none
  finalizing --> splitting_required : [lambda_guards_7_34] / run_finalize_
  splitting_required --> errored : [lambda_guards_11_38] / none
  splitting_required --> done : [lambda_guards_7_34] / run_split_required_
  done --> errored : [lambda_guards_11_38] / none
  done --> idle : [lambda_guards_7_34] / on_plan_done_
  errored --> idle : [lambda_guards_15_32] / on_plan_error_
  resetting --> errored : plan [always] / on_unexpected_
  seeding_leafs --> errored : plan [always] / on_unexpected_
  counting_references --> errored : plan [always] / on_unexpected_
  allocating_explicit_inputs --> errored : plan [always] / on_unexpected_
  planning_nodes --> errored : plan [always] / on_unexpected_
  releasing_expired --> errored : plan [always] / on_unexpected_
  finalizing --> errored : plan [always] / on_unexpected_
  splitting_required --> errored : plan [always] / on_unexpected_
  done --> errored : plan [always] / on_unexpected_
  errored --> errored : plan [always] / on_unexpected_
