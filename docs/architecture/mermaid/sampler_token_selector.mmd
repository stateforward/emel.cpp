stateDiagram-v2
  direction TB
  [*] --> initialized
  initialized --> validating : select_token [always] / begin_select_token_
  validating --> validate_decision : [always] / run_validate_
  validate_decision --> errored : [phase_failed_] / none
  validate_decision --> selecting_token : [phase_ok_] / none
  selecting_token --> select_decision : [always] / run_select_
  select_decision --> errored : [phase_failed_] / none
  select_decision --> done : [phase_ok_] / none
  done --> initialized : [always] / publish_done_
  errored --> initialized : [always] / publish_error_
  initialized --> errored : _ [always] / on_unexpected_
  validating --> errored : _ [always] / on_unexpected_
  validate_decision --> errored : _ [always] / on_unexpected_
  selecting_token --> errored : _ [always] / on_unexpected_
  select_decision --> errored : _ [always] / on_unexpected_
  done --> errored : _ [always] / on_unexpected_
  errored --> errored : _ [always] / on_unexpected_
